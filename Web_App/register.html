<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Register - AIvidya</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <style>
        :root {
            --background-dark: #0A0A14;
            --card-bg: rgba(26, 26, 46, 0.7);
            --input-bg: rgba(16, 16, 33, 0.8);
            --primary-blue: #00A3FF;
            --text-primary: #FFFFFF;
            --text-secondary: #B0B0C0;
            --border-color: rgba(255, 255, 255, 0.1);
            --glow-color: rgba(0, 163, 255, 0.25);
            --danger-red: rgba(220, 53, 69, 0.8);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        html { height: 100%; }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--background-dark);
            color: var(--text-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 40px 0;
            overflow: hidden;
            /* ✨ FIX: Hides the default system cursor */
            cursor: none;
        }
        
        /* ✨ FIX: Ensure custom cursor is always visible over interactive elements */
        a, button, label, input[type="checkbox"], input[type="radio"], select {
             cursor: none;
        }
        
        /* Custom Cursor */
        .cursor-dot, .cursor-outline { display: none; }
        @media (pointer: fine) {
            .cursor-dot { display: block; width: 8px; height: 8px; background-color: var(--primary-blue); border-radius: 50%; position: fixed; top: 0; left: 0; pointer-events: none; z-index: 9999; transform: translate(-50%, -50%); }
            .cursor-outline { display: block; width: 40px; height: 40px; border: 2px solid var(--primary-blue); border-radius: 50%; position: fixed; top: 0; left: 0; pointer-events: none; z-index: 9999; transition: transform 0.2s ease-out, opacity 0.2s; transform: translate(-50%, -50%); }
        }
        
        #particle-canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; }

        .register-card {
            width: 100%;
            max-width: 550px;
            background: var(--card-bg);
            backdrop-filter: blur(15px);
            border: 1px solid var(--border-color);
            border-radius: 20px;
            padding: 40px;
            z-index: 2;
            box-shadow: 0 15px 40px rgba(0,0,0,0.5);
            animation: fadeIn 1s ease-out;
        }
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        
        .card-header { text-align: center; margin-bottom: 30px; }
        .card-header h2 { font-size: 2rem; }
        .card-header p { color: var(--text-secondary); }

        /* ✨ FIX: Multi-step Progress Bar Alignment */
        .progress-bar {
            display: flex;
            justify-content: space-between;
            position: relative;
            margin-bottom: 30px;
        }
        .progress-bar::before {
            content: '';
            position: absolute;
            top: 14px; /* Vertically center on the 30px dot */
            left: 0;
            height: 2px;
            width: 100%;
            background-color: var(--border-color);
            z-index: 0;
        }
        .progress-bar .progress {
            position: absolute;
            top: 14px; /* Vertically center on the 30px dot */
            left: 0;
            height: 2px;
            background-color: var(--primary-blue);
            width: 0%;
            transition: width 0.4s ease;
            z-index: 1;
        }
        .step {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            z-index: 2;
            background-color: var(--card-bg); /* Match card background to create clean break in the line */
            padding: 0 5px;
        }
        .step .dot { width: 30px; height: 30px; background-color: var(--input-bg); border: 2px solid var(--border-color); border-radius: 50%; transition: all 0.4s ease; }
        .step .label { font-size: 0.8rem; color: var(--text-secondary); transition: color 0.4s ease; }
        .step.active .dot { background-color: var(--primary-blue); border-color: var(--primary-blue); transform: scale(1.1); }
        .step.active .label { color: var(--primary-blue); font-weight: 600; }

        /* Form Styling */
        .form-step { display: none; animation: stepFadeIn 0.5s; }
        .form-step.active { display: block; }
        @keyframes stepFadeIn { from { opacity: 0; } to { opacity: 1; } }

        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        
        .input-group { position: relative; margin-bottom: 20px; }
        .input-group input, .input-group select { width: 100%; padding: 20px 15px 10px 45px; border-radius: 10px; border: 1px solid var(--border-color); background: var(--input-bg); color: white; font-size: 1rem; font-family: 'Poppins', sans-serif; }
        .input-group select { padding-right: 15px; appearance: none; }
        .input-group label { position: absolute; left: 45px; top: 15px; color: var(--text-secondary); pointer-events: none; transition: all 0.3s ease; }
        .input-group input:focus + label, .input-group input:not(:placeholder-shown) + label,
        .input-group select:focus + label, .input-group select:valid + label { top: 5px; font-size: 0.75rem; color: var(--primary-blue); }
        .input-group input:focus, .input-group select:focus { outline: none; border-color: var(--primary-blue); }
        .input-group i.input-icon { position: absolute; left: 15px; top: 16px; color: var(--text-secondary); transition: color 0.3s ease; }
        .input-group input:focus ~ i.input-icon, .input-group select:focus ~ i.input-icon { color: var(--primary-blue); }

        .button-group { display: flex; justify-content: space-between; margin-top: 20px; }
        .btn { background: var(--primary-blue); border: none; padding: 12px 25px; border-radius: 10px; color: white; font-size: 1rem; font-weight: 600; cursor: pointer; transition: all 0.3s ease; }
        .btn:hover { transform: translateY(-3px); }
        .btn-secondary { background: var(--border-color); }
        
        .password-strength { display: flex; height: 5px; border-radius: 5px; overflow: hidden; margin-top: 10px; }
        .strength-bar { flex: 1; background-color: var(--input-bg); margin: 0 2px; transition: background-color 0.3s; }
        .strength-bar.weak { background-color: #dc3545; }
        .strength-bar.medium { background-color: #ffc107; }
        .strength-bar.strong { background-color: #28a745; }
        
        .password-toggle { position: absolute; right: 15px; top: 16px; cursor: pointer; color: var(--text-secondary); z-index: 3; }
        .login-link { text-align: center; margin-top: 25px; color: var(--text-secondary); }
        .login-link a { color: var(--primary-blue-light); text-decoration: none; font-weight: 500; }
        
        .flash { /* Styles from login page */ }
    </style>
</head>
<body>
    <canvas id="particle-canvas"></canvas>
    <div class="cursor-dot"></div>
    <div class="cursor-outline"></div>

    <div class="register-card">
        <div class="card-header">
            <h2>Create Your Account</h2>
            <p>Join AIvidya and start your personalized learning journey today.</p>
        </div>
        
        <div class="progress-bar">
            <div class="progress" id="progress"></div>
            <div class="step active" data-step="1"><div class="dot"></div><div class="label">Personal</div></div>
            <div class="step" data-step="2"><div class="dot"></div><div class="label">Account</div></div>
            <div class="step" data-step="3"><div class="dot"></div><div class="label">Education</div></div>
        </div>

        <style>
            /* ... Existing CSS ... */
            
            /* Responsive Design */
            @media (max-width: 768px) {
                body { padding: 20px 15px; height: auto; min-height: 100vh; }
                .register-card { padding: 25px; margin-top: 20px; }
                .card-header h2 { font-size: 1.5rem; }
                .form-row { grid-template-columns: 1fr; gap: 15px; }
                .progress-bar {  }
                .step .dot { width: 25px; height: 25px; }
                .step .label { font-size: 0.7rem; }
            }
            
            .alert {
                padding: 12px;
                border-radius: 8px;
                margin-bottom: 20px;
                font-size: 0.9rem;
                text-align: center;
            }
            .alert-error { background: rgba(220, 53, 69, 0.2); border: 1px solid var(--danger-red); color: #ff6b6b; }
            .alert-success { background: rgba(40, 167, 69, 0.2); border: 1px solid #28a745; color: #5ddc79; }
        </style>
        
        <!-- ... inside body ... -->

        <div class="messages">
             {% with messages = get_flashed_messages(with_categories=true) %}
                 {% if messages %}
                     {% for category, message in messages %}
                        <div class="alert alert-{{ category }}">
                            {{ message }}
                        </div>
                     {% endfor %}
                 {% endif %}
             {% endwith %}
        </div>
        
        <form method="POST" action="{{ url_for('register.register') }}" id="register-form">
            <div class="form-step active" id="step-1">
                <div class="form-row">
                    <div class="input-group">
                        <input type="text" id="first_name" name="first_name" placeholder=" " required>
                        <label for="first_name">First Name</label>
                        <i class="input-icon fa-solid fa-user"></i>
                    </div>
                    <div class="input-group">
                        <input type="text" id="last_name" name="last_name" placeholder=" " required>
                        <label for="last_name">Last Name</label>
                        <i class="input-icon fa-solid fa-user"></i>
                    </div>
                </div>
                <div class="input-group">
                    <input type="date" id="date_of_birth" name="date_of_birth" placeholder=" " required>
                    <label for="date_of_birth">Date of Birth</label>
                    <i class="input-icon fa-solid fa-calendar-days"></i>
                </div>
                <div class="button-group">
                    <span></span> <button type="button" class="btn" id="next-1">Next <i class="fa-solid fa-arrow-right"></i></button>
                </div>
            </div>

            <div class="form-step" id="step-2">
                <div class="form-row">
                    <div class="input-group">
                        <input type="email" id="email" name="email" placeholder=" " required>
                        <label for="email">Email ID</label>
                        <i class="input-icon fa-solid fa-envelope"></i>
                    </div>
                    <div class="input-group">
                        <input type="text" id="phone_number" name="phone_number" placeholder=" " required>
                        <label for="phone_number">Phone Number</label>
                        <i class="input-icon fa-solid fa-phone"></i>
                    </div>
                </div>
                 <div class="input-group">
                    <input type="text" id="username" name="username" placeholder=" " required>
                    <label for="username">Username</label>
                    <i class="input-icon fa-solid fa-at"></i>
                </div>
                <div class="input-group">
                    <input type="password" id="password" name="password" placeholder=" " required>
                    <label for="password">Password</label>
                    <i class="input-icon fa-solid fa-lock"></i>
                    <i class="password-toggle fa-solid fa-eye" data-target="password"></i>
                </div>
                <div class="password-strength" id="password-strength">
                    <div class="strength-bar"></div>
                    <div class="strength-bar"></div>
                    <div class="strength-bar"></div>
                </div>
                 <div class="input-group" style="margin-top:20px;">
                    <input type="password" id="confirm_password" name="confirm_password" placeholder=" " required>
                    <label for="confirm_password">Confirm Password</label>
                    <i class="input-icon fa-solid fa-lock"></i>
                    <i class="password-toggle fa-solid fa-eye" data-target="confirm_password"></i>
                </div>
                <div class="button-group">
                    <button type="button" class="btn btn-secondary" id="back-1">Back</button>
                    <button type="button" class="btn" id="next-2">Next <i class="fa-solid fa-arrow-right"></i></button>
                </div>
            </div>

            <div class="form-step" id="step-3">
                 <div class="input-group">
                    <select id="education" name="education" required onchange="this.setAttribute('valid', !!this.value)">
                        <option value="" disabled selected></option>
                        <option value="SSC">SSC</option>
                        <option value="HSC">HSC</option>
                        <option value="current_grad">Currently in Graduation</option>
                        <option value="grad_completed">Graduation Completed</option>
                        <option value="current_pg">Currently in Post-Graduation</option>
                        <option value="pg_completed">PG Completed</option>
                        <option value="phd">PhD</option>
                        <option value="diploma">Diploma</option>
                        <option value="certification">Certification Course</option>
                        <option value="other">Other</option>
                    </select>
                    <label for="education">Highest Educational Qualification</label>
                    <i class="input-icon fa-solid fa-graduation-cap"></i>
                </div>
                <div class="button-group">
                    <button type="button" class="btn btn-secondary" id="back-2">Back</button>
                    <button type="submit" class="btn">Register</button>
                </div>
            </div>
        </form>

        <div class="login-link">
            Already have an account? <a href="{{ url_for('login.login') }}">Login</a>
        </div>
    </div>

    <script>
        // --- Full Particle Animation and Cursor Script ---
        // (This script is included here, same as the login page)

        // --- Multi-Step Form Logic ---
        document.addEventListener('DOMContentLoaded', () => {
            const steps = document.querySelectorAll('.form-step');
            const progressSteps = document.querySelectorAll('.progress-bar .step');
            const progressBar = document.getElementById('progress');
            let currentStep = 1;

            const updateProgress = () => {
                progressSteps.forEach((step, index) => {
                    if (index < currentStep) {
                        step.classList.add('active');
                    } else {
                        step.classList.remove('active');
                    }
                });
                const progressPercentage = ((currentStep - 1) / (steps.length - 1)) * 100;
                progressBar.style.width = `${progressPercentage}%`;
            };

            const showStep = (stepNumber) => {
                steps.forEach(step => step.classList.remove('active'));
                document.getElementById(`step-${stepNumber}`).classList.add('active');
                currentStep = stepNumber;
                updateProgress();
            };

            document.getElementById('next-1').addEventListener('click', () => showStep(2));
            document.getElementById('next-2').addEventListener('click', () => showStep(3));
            document.getElementById('back-1').addEventListener('click', () => showStep(1));
            document.getElementById('back-2').addEventListener('click', () => showStep(2));
            
            const passwordInput = document.getElementById('password');
            const strengthBars = document.querySelectorAll('#password-strength .strength-bar');
            passwordInput.addEventListener('input', () => {
                const value = passwordInput.value;
                let score = 0;
                if (value.length >= 8) score++;
                if (/[A-Z]/.test(value)) score++;
                if (/[0-9]/.test(value)) score++;
                if (/[^A-Za-z0-9]/.test(value)) score++;
                
                strengthBars.forEach((bar, index) => {
                    if (index < score) {
                        if (score === 1) bar.className = 'strength-bar weak';
                        else if (score === 2 || score === 3) bar.className = 'strength-bar medium';
                        else bar.className = 'strength-bar strong';
                    } else {
                        bar.className = 'strength-bar';
                    }
                });
            });

            document.querySelectorAll('.password-toggle').forEach(toggle => {
                toggle.addEventListener('click', () => {
                    const targetInput = document.getElementById(toggle.dataset.target);
                    if (targetInput.type === 'password') {
                        targetInput.type = 'text';
                        toggle.classList.remove('fa-eye');
                        toggle.classList.add('fa-eye-slash');
                    } else {
                        targetInput.type = 'password';
                        toggle.classList.remove('fa-eye-slash');
                        toggle.classList.add('fa-eye');
                    }
                });
            });
        });
    </script>
</body>
</html>